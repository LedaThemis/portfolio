---
layout: ../../layouts/ProjectDetailsLayout.astro
projectName: "Odinbook"
projectSummary: "A place to share moments and chat with friends."
projectCover: "https://res.cloudinary.com/dj08db9y2/image/upload/v1665245191/odinbook_home_318fe8e362.png"
projectDescription: "A social media app that allows you to share moments of your life, and gives you the ability to chat with friends."
projectTechnologies: "express react mongodb socketdotio typescript styledcomponents jest testinglibrary"
projectSource: "https://github.com/LedaThemis/odin-book"
projectDemo: "https://leda-odin-book.web.app"
---

### Notable Features

- Sign in as a guest
- Sign in with Google
- Real-time updates of the home feed
- Chat with friends
- Create, edit and delete posts
- Like and comment on posts
- Send and receive friend requests
- Search for users by their name

### Why was this built

I've always wanted a way to privately share moments of life with close ones, and this project was the result.

Note: this project was also part of [_The Odin Project_](https://www.theodinproject.com/)

### Real-time updates of the home feed

Implementing this had its challenges, most notably synchronizing the state between the client and server.

The initial implementation had two states, one for posts fetched from the Express server (and posts from the current user) and the other for the [Socket.IO](https://socket.io/) ones (to have real-time updates), which wasn't pleasant to work with.

<img
  src="https://res.cloudinary.com/dj08db9y2/image/upload/v1665245188/odinbook_initial_sync_structure_d2ec9cfc5b.png"
  alt=""
/>
Diagram: showing the old structure of synchronizing state in Odinbook

As you can see we have two sources of posts, one from the Socket.IO server and the other from the [Express](https://expressjs.com/) server. To get the complete timeline, we need to concatenate them while keeping in mind each post's publishing date, which could introduce bugs.

But! it does not have to be this way.

Enter [Query Invalidation](https://tanstack.com/query/v4/docs/guides/query-invalidation)

As the app uses [Tanstack Query](https://tanstack.com/query/v4) for its data fetching, switching to [Query Invalidation](https://tanstack.com/query/v4/docs/guides/query-invalidation) was super easy, we just invalidate the timeline

- If a friend creates a post
- If a friend updates a post
- If a friend deletes a post

The above we would receive from the [Socket.IO](https://socket.io/) server

- If the current user creates a post
- If the current user friend updates a post
- If the current user deletes a post

And after the above we invalidate the timeline in `onSuccess` function of the [mutation](https://tanstack.com/query/v4/docs/guides/mutations).

<img
  src="https://res.cloudinary.com/dj08db9y2/image/upload/v1665245188/odinbook_new_invalidate_query_sync_structure_d7c13fd302.png"
  alt=""
/>
Diagram: showing the new structure of synchronizing state in Odinbook

The diagram might look more complex compared to the old one, but what matters is that there is only one state! (see [Single source of truth](https://en.wikipedia.org/wiki/Single_source_of_truth))

### Lessons Learned

One of the most important lessons learned from this project was utilizing [Tanstack Query](https://tanstack.com/query/v4) to make custom hooks and use those anywhere in the code to get the data needed.

In addition to that, project structure was also a valuable lesson.
